# Bug Fix: OpenAlex AttributeError

**Date**: 2025-12-23
**File**: `search_openalex.py`
**Issue**: AttributeError when author or work ID is None

## Problem

When OpenAlex returns `null` (Python `None`) for author or work IDs, the code attempted to call `.replace()` on `None`, causing:

```
AttributeError: 'NoneType' object has no attribute 'replace'
```

## Root Cause

Lines using `.get(key, default)` don't protect against explicit `None` values in JSON:

```python
# This fails when id is None (not missing, but explicitly null)
author_info.get("id", "").replace("https://openalex.org/", "")
```

The `.get(key, "")` pattern provides a default for **missing keys**, but when the key exists with value `None`, it returns `None`.

## Fix Applied

Changed from `.get(key, "")` to `(value.get(key) or "")`:

**Line 129** (author ID):
```python
# Before:
"openalex_id": author_info.get("id", "").replace("https://openalex.org/", ""),

# After:
"openalex_id": (author_info.get("id") or "").replace("https://openalex.org/", ""),
```

**Line 164** (work ID):
```python
# Before:
openalex_id = work.get("id", "").replace("https://openalex.org/", "")

# After:
openalex_id = (work.get("id") or "").replace("https://openalex.org/", "")
```

## How It Works

The `or ""` operator returns:
- Empty string `""` if `.get()` returns `None`
- Empty string `""` if `.get()` returns `""` (missing key with default)
- The actual value if `.get()` returns a non-empty string

This ensures `.replace()` is always called on a string, never on `None`.

## Testing

```python
# Test cases
author_info_none = {'id': None}       # Explicit null
author_info_missing = {}              # Missing key
author_info_valid = {'id': 'https://openalex.org/A123'}

# All three now work correctly:
(author_info_none.get('id') or '').replace('https://openalex.org/', '')     # → ''
(author_info_missing.get('id') or '').replace('https://openalex.org/', '')  # → ''
(author_info_valid.get('id') or '').replace('https://openalex.org/', '')    # → 'A123'
```

## Impact

This fix prevents search failures in `domain-literature-researcher` agent when OpenAlex returns records with null author or work IDs. Previously affected searches will now complete successfully.

## Related Issues

- Occurred in literature review: mechanistic-interpretability-ai-safety
- Domains affected: Domain 1 (MI Foundations), Domain 4 (Philosophy of Mechanistic Explanation)
- Error logs: `domain1_openalex.json`, `domain4_openalex.json`
